# 预测结果绘图脚本使用说明

## 脚本功能

这两个脚本用于分析和可视化在线学习的预测结果：

1. **`plot_prediction_results.py`** - 完整功能版本，支持多种分析
2. **`quick_accuracy_plot.py`** - 简化版本，快速查看准确率

## 使用方法

### 1. 快速绘图脚本 (推荐)

#### 基本使用
```bash
# 绘制所有预测结果文件的准确率
python quick_accuracy_plot.py

# 绘制单个文件的详细分析
python quick_accuracy_plot.py prediction_results_20241201_143022.json
```

#### 输出内容
- **准确率趋势图**: 显示预测准确率随时间的变化
- **预测vs实际标签**: 比较预测标签和真实标签
- **统计信息**: 总预测数、正确预测数、最终准确率

### 2. 完整功能脚本

#### 基本使用
```bash
# 分析所有预测结果文件
python plot_prediction_results.py

# 分析特定文件
python plot_prediction_results.py --files prediction_results_20241201_143022.json

# 生成详细分析
python plot_prediction_results.py --detailed

# 不保存图片，只显示
python plot_prediction_results.py --no-save

# 不显示图片，只保存
python plot_prediction_results.py --no-show
```

#### 高级选项
```bash
# 自定义文件模式
python plot_prediction_results.py --pattern "my_results_*.json"

# 分析多个特定文件
python plot_prediction_results.py --files file1.json file2.json file3.json
```

## 图表说明

### 快速绘图脚本输出

1. **准确率趋势图**
   - X轴: 预测次数
   - Y轴: 准确率 (0-1)
   - 显示: 准确率随预测次数的变化趋势

2. **预测vs实际标签图**
   - X轴: 预测次数
   - Y轴: 标签值 (7=左手, 8=右手)
   - 蓝线: 预测标签
   - 红线: 实际标签

### 完整功能脚本输出

1. **准确率随时间变化**
   - 显示每个预测点的准确率
   - 多条线表示多个文件的结果

2. **累积准确率**
   - 显示从开始到当前点的累积准确率
   - 反映整体学习效果

3. **预测vs实际比较**
   - 比较预测标签和真实标签
   - 识别错误预测的位置

4. **最终统计**
   - 柱状图显示总预测数、正确预测数、最终准确率
   - 多个文件的对比

5. **详细分析** (使用--detailed选项)
   - 准确率进展
   - 预测置信度
   - 错误分析

## 输出文件

脚本会生成以下文件：

- `accuracy_plot_YYYYMMDD_HHMMSS.png` - 快速绘图输出
- `prediction_analysis_YYYYMMDD_HHMMSS.png` - 完整分析输出
- `detailed_analysis_filename_YYYYMMDD_HHMMSS.png` - 详细分析输出

## 示例输出

### 控制台输出示例
```
📁 Found 2 result file(s):
   - prediction_results_20241201_143022.json
   - prediction_results_20241201_150145.json

📊 prediction_results_20241201_143022: 15 predictions, 12 correct, final accuracy: 0.800
📊 prediction_results_20241201_150145: 20 predictions, 18 correct, final accuracy: 0.900

💾 Plot saved as: accuracy_plot_20241201_151230.png
```

### 图表内容
- **准确率曲线**: 显示学习过程中准确率的变化
- **标签对比**: 显示预测标签和真实标签的匹配情况
- **统计摘要**: 显示总体性能指标

## 数据格式要求

JSON文件应包含以下结构：

```json
{
  "timestamp": "2024-12-01T14:30:22",
  "statistics": {
    "total_predictions": 15,
    "correct_predictions": 12,
    "accuracy": 0.8,
    "accuracy_history": [0.0, 0.5, 0.67, 0.75, 0.8],
    "prediction_history": [
      {
        "timestamp": 1701435022.123,
        "prediction": 7,
        "true_label": 7,
        "is_correct": true,
        "proba": [0.8, 0.2],
        "accuracy": 1.0
      }
    ]
  }
}
```

## 故障排除

### 常见问题

1. **找不到文件**
   ```
   ❌ No files found matching pattern: prediction_results_*.json
   ```
   - 检查文件是否在当前目录
   - 确认文件名格式正确

2. **数据格式错误**
   ```
   ❌ Error loading file.json: Expecting value: line 1 column 1
   ```
   - 检查JSON文件格式是否正确
   - 确认文件没有损坏

3. **缺少数据**
   ```
   ⚠️ No accuracy history found in file.json
   ```
   - 确认JSON文件包含accuracy_history字段
   - 检查数据是否完整

### 调试建议

1. **检查文件内容**
   ```bash
   # 查看JSON文件内容
   cat prediction_results_20241201_143022.json | head -20
   ```

2. **验证数据完整性**
   ```python
   import json
   with open('prediction_results_20241201_143022.json', 'r') as f:
       data = json.load(f)
   print("Keys:", data.keys())
   print("Statistics keys:", data.get('statistics', {}).keys())
   ```

3. **测试单个文件**
   ```bash
   python quick_accuracy_plot.py prediction_results_20241201_143022.json
   ```

## 自定义选项

### 修改图表样式
在脚本中可以修改以下参数：

```python
# 图表大小
plt.figure(figsize=(12, 8))

# 颜色方案
colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b']

# 线条样式
linewidth=2, marker='o', markersize=4
```

### 保存格式
```python
# 保存为不同格式
plt.savefig('output.png', dpi=300, bbox_inches='tight')  # PNG
plt.savefig('output.pdf', bbox_inches='tight')           # PDF
plt.savefig('output.svg', bbox_inches='tight')           # SVG
``` 